{% doc %}
  @prompt
    Language button

{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-language-button-{{ ai_gen_id }} {
    position: relative;
    display: inline-block;
  }

  .ai-language-toggle-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: {{ block.settings.button_padding }}px;
    background-color: {{ block.settings.button_background }};
    color: {{ block.settings.button_text_color }};
    border: {{ block.settings.border_width }}px solid {{ block.settings.border_color }};
    border-radius: {{ block.settings.border_radius }}px;
    cursor: pointer;
    font-size: {{ block.settings.font_size }}px;
    text-decoration: none;
    transition: all 0.3s ease;
  }

  .ai-language-toggle-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.button_hover_background }};
    color: {{ block.settings.button_hover_text_color }};
    border-color: {{ block.settings.border_hover_color }};
  }

  .ai-language-toggle-{{ ai_gen_id }}:focus {
    outline: 2px solid {{ block.settings.button_text_color }};
    outline-offset: 2px;
  }

  .ai-language-icon-{{ ai_gen_id }} {
    width: {{ block.settings.icon_size }}px;
    height: {{ block.settings.icon_size }}px;
    flex-shrink: 0;
  }

  .ai-language-text-{{ ai_gen_id }} {
    font-weight: {{ block.settings.font_weight }};
    text-transform: {{ block.settings.text_transform }};
  }

  .ai-language-arrow-{{ ai_gen_id }} {
    width: 12px;
    height: 12px;
    transition: transform 0.3s ease;
  }

  .ai-language-dropdown-{{ ai_gen_id }} {
    position: absolute;
    top: calc(100% + 8px);
    left: 0;
    right: 0;
    background-color: {{ block.settings.dropdown_background }};
    border: 1px solid {{ block.settings.dropdown_border_color }};
    border-radius: {{ block.settings.dropdown_border_radius }}px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-8px);
    transition: all 0.3s ease;
    z-index: 1000;
    min-width: {{ block.settings.dropdown_min_width }}px;
  }

  .ai-language-dropdown-{{ ai_gen_id }}.active {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .ai-language-dropdown-{{ ai_gen_id }}.active ~ .ai-language-toggle-{{ ai_gen_id }} .ai-language-arrow-{{ ai_gen_id }} {
    transform: rotate(180deg);
  }

  .ai-language-option-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 16px;
    color: {{ block.settings.dropdown_text_color }};
    text-decoration: none;
    font-size: {{ block.settings.dropdown_font_size }}px;
    transition: background-color 0.2s ease;
    border-bottom: 1px solid {{ block.settings.dropdown_border_color }};
  }

  .ai-language-option-{{ ai_gen_id }}:last-child {
    border-bottom: none;
  }

  .ai-language-option-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.dropdown_hover_background }};
    color: {{ block.settings.dropdown_hover_text_color }};
  }

  .ai-language-option-{{ ai_gen_id }}:focus {
    outline: 2px solid {{ block.settings.button_background }};
    outline-offset: -2px;
  }

  .ai-language-option-{{ ai_gen_id }}.current {
    background-color: {{ block.settings.dropdown_active_background }};
    color: {{ block.settings.dropdown_active_text_color }};
    font-weight: 600;
  }

  .ai-language-flag-{{ ai_gen_id }} {
    width: 20px;
    height: 15px;
    border-radius: 2px;
    flex-shrink: 0;
    font-size: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  @media screen and (max-width: 749px) {
    .ai-language-dropdown-{{ ai_gen_id }} {
      left: auto;
      right: 0;
      min-width: 200px;
    }
  }
{% endstyle %}

<language-selector-{{ ai_gen_id }} class="ai-language-button-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <button
    class="ai-language-toggle-{{ ai_gen_id }}"
    aria-expanded="false"
    aria-haspopup="true"
    aria-label="Select language"
  >
    {% if block.settings.show_icon %}
      <svg class="ai-language-icon-{{ ai_gen_id }}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"/>
        <line x1="2" y1="12" x2="22" y2="12"/>
        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
      </svg>
    {% endif %}

    {% if block.settings.show_current_language %}
      <span class="ai-language-text-{{ ai_gen_id }}">
        {% if block.settings.display_format == 'code' %}
          {{ localization.language.iso_code | upcase }}
        {% elsif block.settings.display_format == 'name' %}
          {{ localization.language.name }}
        {% else %}
          {{ localization.language.endonym_name }}
        {% endif %}
      </span>
    {% endif %}

    {% if block.settings.show_arrow %}
      <svg class="ai-language-arrow-{{ ai_gen_id }}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="6,9 12,15 18,9"/>
      </svg>
    {% endif %}
  </button>

  <div class="ai-language-dropdown-{{ ai_gen_id }}" role="menu">
    {% for language in localization.available_languages %}
      <a
        href="{{ language.root_url }}"
        class="ai-language-option-{{ ai_gen_id }} {% if language.iso_code == localization.language.iso_code %}current{% endif %}"
        role="menuitem"
        hreflang="{{ language.iso_code }}"
        {% if language.iso_code == localization.language.iso_code %}aria-current="true"{% endif %}
      >
        {% if block.settings.show_flags %}
          <span class="ai-language-flag-{{ ai_gen_id }}">
            {% case language.iso_code %}
              {% when 'en' %}🇺🇸
              {% when 'es' %}🇪🇸
              {% when 'fr' %}🇫🇷
              {% when 'de' %}🇩🇪
              {% when 'it' %}🇮🇹
              {% when 'pt' %}🇵🇹
              {% when 'ja' %}🇯🇵
              {% when 'ko' %}🇰🇷
              {% when 'zh' %}🇨🇳
              {% when 'ar' %}🇸🇦
              {% when 'ru' %}🇷🇺
              {% when 'nl' %}🇳🇱
              {% when 'sv' %}🇸🇪
              {% when 'da' %}🇩🇰
              {% when 'no' %}🇳🇴
              {% when 'fi' %}🇫🇮
              {% when 'pl' %}🇵🇱
              {% when 'cs' %}🇨🇿
              {% when 'hu' %}🇭🇺
              {% when 'tr' %}🇹🇷
              {% when 'th' %}🇹🇭
              {% when 'vi' %}🇻🇳
              {% when 'hi' %}🇮🇳
              {% else %}🌐
            {% endcase %}
          </span>
        {% endif %}
        
        <span>
          {% if block.settings.dropdown_display_format == 'code' %}
            {{ language.iso_code | upcase }}
          {% elsif block.settings.dropdown_display_format == 'name' %}
            {{ language.name }}
          {% else %}
            {{ language.endonym_name }}
          {% endif %}
        </span>
      </a>
    {% endfor %}
  </div>
</language-selector-{{ ai_gen_id }}>

<script>
(function() {
  class LanguageSelector{{ ai_gen_id }} extends HTMLElement {
    constructor() {
      super();
    }

    connectedCallback() {
      this.toggle = this.querySelector('.ai-language-toggle-{{ ai_gen_id }}');
      this.dropdown = this.querySelector('.ai-language-dropdown-{{ ai_gen_id }}');
      this.setupEventListeners();
    }

    setupEventListeners() {
      this.toggle.addEventListener('click', (e) => {
        e.preventDefault();
        this.toggleDropdown();
      });

      this.toggle.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          this.toggleDropdown();
        }
      });

      document.addEventListener('click', (e) => {
        if (!this.contains(e.target)) {
          this.closeDropdown();
        }
      });

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          this.closeDropdown();
        }
      });
    }

    toggleDropdown() {
      const isOpen = this.dropdown.classList.contains('active');
      if (isOpen) {
        this.closeDropdown();
      } else {
        this.openDropdown();
      }
    }

    openDropdown() {
      this.dropdown.classList.add('active');
      this.toggle.setAttribute('aria-expanded', 'true');
      
      const firstOption = this.dropdown.querySelector('.ai-language-option-{{ ai_gen_id }}');
      if (firstOption) {
        firstOption.focus();
      }
    }

    closeDropdown() {
      this.dropdown.classList.remove('active');
      this.toggle.setAttribute('aria-expanded', 'false');
    }
  }

  customElements.define('language-selector-{{ ai_gen_id }}', LanguageSelector{{ ai_gen_id }});
})();
</script>

{% schema %}
{
  "name": "Language button",
  "settings": [
    {
      "type": "header",
      "content": "Button display"
    },
    {
      "type": "checkbox",
      "id": "show_icon",
      "label": "Show globe icon",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_current_language",
      "label": "Show current language",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_arrow",
      "label": "Show dropdown arrow",
      "default": true
    },
    {
      "type": "select",
      "id": "display_format",
      "label": "Button language format",
      "options": [
        {
          "value": "code",
          "label": "Language code (EN)"
        },
        {
          "value": "name",
          "label": "Language name (English)"
        },
        {
          "value": "endonym",
          "label": "Native name (English)"
        }
      ],
      "default": "code"
    },
    {
      "type": "header",
      "content": "Dropdown display"
    },
    {
      "type": "checkbox",
      "id": "show_flags",
      "label": "Show country flags",
      "default": true
    },
    {
      "type": "select",
      "id": "dropdown_display_format",
      "label": "Dropdown language format",
      "options": [
        {
          "value": "code",
          "label": "Language code (EN)"
        },
        {
          "value": "name",
          "label": "Language name (English)"
        },
        {
          "value": "endonym",
          "label": "Native name (English)"
        }
      ],
      "default": "endonym"
    },
    {
      "type": "range",
      "id": "dropdown_min_width",
      "min": 150,
      "max": 300,
      "step": 10,
      "unit": "px",
      "label": "Dropdown minimum width",
      "default": 180
    },
    {
      "type": "header",
      "content": "Button style"
    },
    {
      "type": "color",
      "id": "button_background",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Text",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_hover_background",
      "label": "Hover background",
      "default": "#f5f5f5"
    },
    {
      "type": "color",
      "id": "button_hover_text_color",
      "label": "Hover text",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border",
      "default": "#e6e6e6"
    },
    {
      "type": "color",
      "id": "border_hover_color",
      "label": "Hover border",
      "default": "#cccccc"
    },
    {
      "type": "range",
      "id": "button_padding",
      "min": 8,
      "max": 24,
      "step": 2,
      "unit": "px",
      "label": "Padding",
      "default": 12
    },
    {
      "type": "range",
      "id": "border_width",
      "min": 0,
      "max": 4,
      "step": 1,
      "unit": "px",
      "label": "Border width",
      "default": 1
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Border radius",
      "default": 6
    },
    {
      "type": "range",
      "id": "font_size",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Font size",
      "default": 14
    },
    {
      "type": "range",
      "id": "icon_size",
      "min": 14,
      "max": 24,
      "step": 2,
      "unit": "px",
      "label": "Icon size",
      "default": 18
    },
    {
      "type": "select",
      "id": "font_weight",
      "label": "Font weight",
      "options": [
        {
          "value": "400",
          "label": "Normal"
        },
        {
          "value": "500",
          "label": "Medium"
        },
        {
          "value": "600",
          "label": "Semibold"
        },
        {
          "value": "700",
          "label": "Bold"
        }
      ],
      "default": "400"
    },
    {
      "type": "select",
      "id": "text_transform",
      "label": "Text case",
      "options": [
        {
          "value": "none",
          "label": "Default"
        },
        {
          "value": "uppercase",
          "label": "Uppercase"
        }
      ],
      "default": "none"
    },
    {
      "type": "header",
      "content": "Dropdown style"
    },
    {
      "type": "color",
      "id": "dropdown_background",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "dropdown_text_color",
      "label": "Text",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "dropdown_hover_background",
      "label": "Hover background",
      "default": "#f5f5f5"
    },
    {
      "type": "color",
      "id": "dropdown_hover_text_color",
      "label": "Hover text",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "dropdown_active_background",
      "label": "Active background",
      "default": "#e6f3ff"
    },
    {
      "type": "color",
      "id": "dropdown_active_text_color",
      "label": "Active text",
      "default": "#0066cc"
    },
    {
      "type": "color",
      "id": "dropdown_border_color",
      "label": "Border",
      "default": "#e6e6e6"
    },
    {
      "type": "range",
      "id": "dropdown_border_radius",
      "min": 0,
      "max": 16,
      "step": 2,
      "unit": "px",
      "label": "Border radius",
      "default": 6
    },
    {
      "type": "range",
      "id": "dropdown_font_size",
      "min": 12,
      "max": 18,
      "step": 1,
      "unit": "px",
      "label": "Font size",
      "default": 14
    }
  ],
  "presets": [
    {
      "name": "Language button"
    }
  ]
}
{% endschema %}